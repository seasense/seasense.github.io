<html>
	<head>
		<title>ACT</title>
		
		<script src="jspsych-5.0.3-act/jspsych.js"></script>
		<script src="jspsych-5.0.3-act/plugins/jspsych-button-response-ACT.js"></script>
		<script src="jspsych-5.0.3-act/plugins/jspsych-instructions.js"></script>
		<script src="jspsych-5.0.3-act/plugins/jspsych-survey-text.js"></script>
		<script src="jspsych-5.0.3-act/plugins/jspsych-survey-text_persCode.js"></script>
		<script src="jspsych-5.0.3-act/plugins/jspsych-survey-multi-choice.js"></script>
		
		<link href="jspsych-5.0.3-act/css/jspsych_act.css" rel="stylesheet" type="text/css"></link>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<base target="_blank">

	</head>
	
	<script>
		function lettersFx () {
			letters_trial_x = jsPsych.randomization.repeat(letters, 1),
			letters_trial_x = letters_trial_x.slice(0,t_SetSize)
			return letters_trial_x
		};
	</script>
		
	<script>
		function eqGenerator () {
			var eq_array_display = []
			var eq_array_respCorrect = []
			for (j = 0; j < nEqs; j++){
				eqGeneFx_result = eqGeneFx ()
				display_j = eqGeneFx_result.displayed_equation
				response_j = eqGeneFx_result.required_response
				eq_array_display.push(display_j)
				eq_array_respCorrect.push(response_j);
			}
			return {eq_array_display:eq_array_display, eq_array_respCorrect: eq_array_respCorrect}
		};
	</script>

	<script>

		function pick_a_stimulus(){
			return Math.floor(Math.random()*stimuli.length)
		};

	</script>

	<script>
		
		function pick_a_stimulus2(stimuli){
			for(i=0;i<stimuli.length;i++){
				if(i==0){
					var stimuli_ordered=[]
					var stimuli_IDs=[]
					for(x=0;x<stimuli.length;x++){stimuli_IDs.push(x)}
				}
				sample_i = Math.floor(Math.random()*stimuli_IDs.length)
				
				stimuli_ordered.push(stimuli_IDs[sample_i])
				sample_i_ID = stimuli_IDs.indexOf(sample_i)
				stimuli_IDs.splice(sample_i,1)
				
			}
			return stimuli_ordered
		}


	</script>
	
	
	<script>

	var stimuli_training = ["Katze"];
	var stimuli_test = ["kalt" , "Musik" , "Schaf" , "Mond" , "Hand" , "Ozean" , 
                      "Stra&#xDF;e" , "rot" , "K&#xF6;nig" , "Licht" , "Berg" , "L&#xF6;we"];

	var nAsso_per_stim = 10;
	
	
///////// Intro
/////////
	var welcome = {
			type: 'instructions',
			pages: [function(){return("<h2>Willkommen zum <b>Association Chain-Task (<span style='color:#ff6699'>ACT</span>)</b>!</h2> <p><b style='color:#ff6699'>ACT</b> stellt Ihre verbale Flexibilit&#xE4;t auf die Probe.<br> Ausgehend von einem Startbegriff sollen Sie m&#xF6;glichst <i>z&#xFC;gig</i> eine m&#xF6;glichst <i>abwechslungsreiche</i> Kette von "+nAsso_per_stim+" Assoziationen bilden, in der sich jedes neu produzierte Wort auf das vorherige bezieht.<p><b>Beispiel</b>: <br>Lebkuchen &#x2192; Zimt, Weihnachten, Krippe, Esel, Ohren, h&#xF6;ren, Musik, Geige, Bogen, rund <p>Klicken Sie <i>Weiter</i>, um sich f&#xFC;r die Teilnahme einverstanden zu erkl&#xE4;ren.  <br>Anschlie&#xDF;end folgt ein kurzer &#xDC;bungsdurchgang.")}],
			//<p>In jedem Durchgang, sollen 10 Assoziationen produziert werden. Antworten Sie mit einzelnen W&#xF6;rtern (d.h. keine Phrasen). Gewertet wird die Flexibilit&#xE4;t ihrer Antworten. 
			show_clickable_nav: true,
			on_finish: function(data) { 
				stimuli = stimuli_training;
				stimulus_x = 0;
				stimulus_order = pick_a_stimulus2(stimuli);
			},	
	};
	/*var task_description = {
			type: 'instructions',
			pages: ["<b>Instruktion</b> <p>Ausgehend von einem Startbegriff soll eine Assoziationskette gebildet werden. <br>Daf&#xFC;r bilden Sie jeweils eine Assoziation zum zuletzt genannten Wort und geben Sie diese &#xFC;ber die Buchstaben-Buttons in das daf&#xFC;r vorhergesehene Antwortfeld ein.<p>D.h. nennen Sie zuerst Ihre erste Assoziation zum vorgegebenen Wort, dann Ihre erste Assoziation zu ihrer vorherigen Antwort u.s.w.<br>So entsteht eine Kette von Assoziationen, wobei sich jede auf ihren Vorg&#xE4;nger bezieht.<p><b>Beispiel:</b><p>Sommer &#x2212;&#x2212;&#x3E;    Strand, Sandburg, Schlo&#xDF;, Ritter, k&#xE4;mpfen, ..<p>In jedem Durchgang, sollen 10 Assoziationen produziert werden. Antworten Sie mit einzelnen W&#xF6;rtern (d.h. keine Phrasen). Gewertet wird die Flexibilit&#xE4;t ihrer Antworten. <p>Klicken Sie <i>Weiter</i>, um sich f&#xFC;r die Teilnahme einverstanden zu erkl&#xE4;ren.  <br>Anschlie&#xDF;end folgt ein kurzer &#xDC;bungsdurchgang."],
			show_clickable_nav: true,
	};*/

	var informedConsent1 = {
		type: 'survey-multi-choice',
		questions: ["<b>Einverst&#xE4;ndniserkl&#xE4;rung </b>1/3"],
		options: [["Ich habe die vorherige Instruktionen gelesen und erkl&aumlre mich bereit zur Teilnahme."]],
		required: [true]
    };
	var informedConsent2 = {
		type: 'survey-multi-choice',
		questions: ["<b>Einverst&#xE4;ndniserkl&#xE4;rung </b>2/3"],
		options: [["Ich stimme zu, dass meine pseudonymisierten Daten zur Ver&oumlffentlichung wissenschaftlicher Arbeiten verwendet werden."]],
		required: [true]
    };
    var informedConsent3 = {
		type: 'survey-multi-choice',
		questions: ["<b>Einverst&#xE4;ndniserkl&#xE4;rung </b>3/3"],
		options: function(){return([["Ich stimme zu, dass meine pseudonymisierten Daten zum Zweck der wissenschaftlichen Transparenz f&uumlr andere WissenschaftlerInnen im <a href='https://osf.io/'> Open Science Framework </a> verf&uumlgbar gemacht werden."]])},
		required: [true]
    };
	var persData_code = ["<p> Generieren Sie Ihren Personencode:"];
	var demographics = {
	  		type: "survey-text-persCode",
	  		questions: persData_code,
			preamble: "<b>Anleitung zum Generieren des Codes</b>: <br> 1.Stelle: Erster Buchstabe des Vornamens Ihrer Mutter (z.B. <b>M</b>artha) <br> 2.Stelle: Erster Buchstabe des Vornamens Ihres Vaters (z.B. <b>S</b>igmund) <br> Stellen 3-4: Ihr Geburtsjahr (z.B. 18<b>95</b>)<br> 5.Stelle: Erster Buchstabe Ihrer aktuellen Wohnadresse (z.B. <b>B</b>erggasse) <br> 6.Stelle: Erste Ziffer Ihrer Hausnummer (z.B. <b>1</b>9) <p> Beispiel vollst&#xE4;ndiger Code: <b>MS95B1</b>",
			on_finish: function(data) { 
		 		code_length = data.code_length;
		 		if(code_length!=6){alert("Bitte geben Sie einen 6-stelligen Personencode ein.")}
		 		console.log(code_length)
		 	}
	};
	var persCode_loop = {
		timeline: [demographics],
		loop_function: function(data){
				if(code_length!=6){
		            return true;
		        } else {
		            return false;
		        }
		  },

	};
///////// Practice
	var practice_overview = {
		type: 'instructions',
		pages: ["<b>&#xDC;bungsdurchgang</b> <p>Produzieren Sie nun ausgehend von einem vorgegebenen Begriff eine Kette von "+nAsso_per_stim+" Assoziationen, in der sich jede produzierte Assoziation auf die vorherige bezieht. <p>Wie die untere Abbildung zeigt, erfolgt die Eingabe eines jeden Wortes anhand einer virtuellen Tatstaur, deren Buchstaben Sie per Maus oder durch Tippen (Touchscreen) bet&#xE4;tigen (siehe Ziffer 1 in der Abbildung). <p><IMG src='ACT_screenshot.png' class='center'></IMG></p> Im  Beispiel lautet der vorgegebene Begriff 'Lebkuchen' und die erste Assoziation lautet 'Zimt'. Durch Klicken des <i>Submit</i>-Buttons (siehe Ziffer 2) wird die Eingabe des n&#xE4;chsten Wortes erm&#xF6;glicht (siehe rechtes Bild): Die zuvor produzierte Assoziation 'Zimt' tritt an die Stelle des Ausgangsbegriffes 'Lebkuchen' (siehe Ziffer 3) und wird zum Ausgangspunkt einer weiteren Assoziation, n&#xE4;mlich 'Weihnachten' (Ziffer 4), usw. <p> Klicken Sie <i>Weiter</i>, um mit dem &#xDC;bungsdurchgang zu beginnen."],
		show_clickable_nav: true,
		
	};
	var associate = {
  		type: 'button-response-act',
  		is_html: true,
		iteration: function(){return iter_i},
		stimulus: function(){if(iter_i==0){stimulus_iter_i = stimuli[stimulus_order[stimulus_x]], cue="Begriff"}else{stimulus_iter_i = current_associate, cue="Vorherige Assoziation"};return ["<span style='font-size:30px; padding:30px'>"+cue+": "+stimulus_iter_i+""]},
		showEndButton: true,
		//prompt: "Zur Eingabe Ihrer Assoziation klicke bzw. tippe auf die Buchstaben-Buttons.",
		letters1: [["Q"],["W"],["E"],["R"],["T"],["Z"],["U"],["I"],["O"],["P"],["\xDC"],["L\xf6schen"]],
		letters2: [["A"],["S"],["D"],["F"],["G"],["H"],["J"],["K"],["L"],["\xD6"],["\xC4"]],
		letters3: [["Y"],["X"],["C"],["V"],["B"],["N"],["M"],["_"],["\xDF"]],	
		prompt2: function(){return ("<br>"+"Anzahl noch zu produzierender Assoziationen: "+(nAsso_per_stim-(iter_i+1))+"")},
		response_ends_trial: false,
		on_finish: function(data) {  
			if(iter_i==(nAsso_per_stim-1)){stimulus_x+=1;}
			iter_i+=1
			current_associate = data.clickedLetters
		},	
	};
	var associate_loop = {
		timeline: [associate],
		loop_function: function(data){
				if(iter_i<nAsso_per_stim){
		            return true;
		        } else {
		            return false;
		        }
		  },
	};
	var training_loop = {
		timeline: [associate_loop,prepare_for_next_stimulus_training],
		loop_function: function(data){
				if(stimulus_x<stimuli.length){
		            return true;
		        } else {
		            return false;
		        }
		  },
	};
	var announce_endOfTraining = {
		type: 'instructions',
		pages: ["<p><p><p>Der &#xDC;bungsdurchgang ist zu Ende. <p> Klicken Sie <i>Weiter</i>, um nun den offiziellen Teil der Aufgabe zu absolvieren."],
		show_clickable_nav: true,
		on_finish: function(data) { 
				stimuli = stimuli_test;
				stimulus_x = 0;
				stimulus_order = pick_a_stimulus2(stimuli);
		},
	}
	var prepare_for_next_stimulus = {
		type: 'instructions',
		pages: [function(){
			if(stimulus_x==0){return "Es folgt nun der 1. Begriff."};
			if(stimulus_x==stimuli.length){return "Vielen Dank! Der Task ist nun zu Ende."};
			if(stimulus_x>0&stimulus_x<stimuli.length){ return "Es folgt nun der n\xe4chste Begriff."}
		}],
		show_clickable_nav: true,
		on_finish: function(data) { 
			iter_i=0
			
		},
	};
	var prepare_for_next_stimulus_training = {
		type: 'instructions',
		pages: [function(){
			if(stimulus_x==0){return "Es folgt nun der 1. Begriff."};
			if(stimulus_x==stimuli.length){return "Vielen Dank! Der &#xDC;bungsdurchgang ist nun zu Ende."};
			if(stimulus_x>0&stimulus_x<stimuli.length){ return "Es folgt nun der n\xe4chste Begriff."}
		}],
		show_clickable_nav: true,
		on_finish: function(data) { 
			iter_i=0
			
		},
	};
	var stimulus_loop = {
		timeline: [associate_loop,prepare_for_next_stimulus],
		loop_function: function(data){
				if(stimulus_x<stimuli.length){
		            return true;
		        } else {
		            return false;
		        }
		  },
	};
	var goodbye = {
			type: 'instructions',
			pages: [function(){return("Vielen Dank f&#xFC;r ihre Teilnahme! <br>Klicken Sie <i>Weiter</i>, um den Download ihrer Daten in ihren Download-Folder zu veranlassen. Senden Sie dieses File anschlie&#xDF;end an die E-Mail Adresse: a01314341@unet.univie.ac.at.  <br>Hinweis: wenn mit Safari gearbeitet wurde, laden Sie die Datei nachdem Sie <i>Weiter</i> geklickt haben, &#xFC;ber den Befehl cmd+s herunter. ")}],
			show_clickable_nav: true,	
	};
			
	jsPsych.init({
		timeline: [welcome,
					informedConsent1,informedConsent2,informedConsent3,
					persCode_loop,
					practice_overview,prepare_for_next_stimulus_training,training_loop,announce_endOfTraining,prepare_for_next_stimulus, stimulus_loop,
					goodbye],
	   	fullscreen: false,
	   	on_finish: function(data){
	        jsPsych.data.localSave('myData_sendMeTo_pseiti@tlu.ee.txt', 'csv');
	        $.post( "http://web.htk.tlu.ee/dinogame" + "/ajax.php?method=save_data", JSON.stringify({"JSON" : jsPsych.data.dataAsJSON(), "CSV" : jsPsych.data.dataAsCSV()}) );
	   }
	});
	
		
	</script>
		
</html>